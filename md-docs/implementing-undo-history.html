<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>implementing-undo-history</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}

  </style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bgoonz/GIT-CDN-FILES/prism.css">

<script async defer src="https://cdn.jsdelivr.net/gh/bgoonz/GIT-CDN-FILES/prism.js"></script>
    </head>
<body>

<ul>




class="menu__link menu__link--active active">Implementing Undo History</a></li>
<li><a href="isolating-redux-sub-apps.html" class="menu__link">Isolating Redux Sub-Apps</a></li>
<li><a href="code-splitting.html" class="menu__link">Code Splitting</a></li>

<ul>

</ul></li>
</ul></li>


</li>
<li><a href="#!" class="menu__link menu__link--sublist">FAQ</a>
<ul>

</ul></li>

<ul>

</ul></li>


<h1 id="implementing-undo-history"><span id="implementing-undo-history" class="anchor enhancedAnchor_2LWZ"></span>Implementing Undo History<a href="#implementing-undo-history" class="hash-link" title="Direct link to heading">#</a></h1>
<h5 id="prerequisites"><span class="admonition-icon"> </span>Prerequisites</h5>
<ul>
<li>Completion of the <a href="../tutorials/fundamentals/part-1-overview.html">“Redux Fundamentals” tutorial</a></li>
<li>Understanding of <a href="../tutorials/fundamentals/part-3-state-actions-reducers.html#splitting-reducers">“reducer composition”</a></li>
</ul>
<p>Building an Undo and Redo functionality into an app has traditionally required conscious effort from the developer. It is not an easy problem with classical MVC frameworks because you need to keep track of every past state by cloning all relevant models. In addition, you need to be mindful of the undo stack because the user-initiated changes should be undoable.</p>
<p>This means that implementing Undo and Redo in an MVC application usually forces you to rewrite parts of your application to use a specific data mutation pattern like <a href="../../en.wikipedia.org/wiki/Command_pattern.html">Command</a>.</p>
<p>With Redux, however, implementing undo history is a breeze. There are three reasons for this:</p>
<ul>
<li>There are no multiple models—just a state subtree that you want to keep track of.</li>
<li>The state is already immutable, and mutations are already described as discrete actions, which is close to the undo stack mental model.</li>
<li>The reducer <code class="language-js" >(state, action) =&gt; state</code> signature makes it natural to implement generic “reducer enhancers” or “higher order reducers”. They are functions that take your reducer and enhance it with some additional functionality while preserving its signature. Undo history is exactly such a case.</li>
</ul>
<p>In the first part of this recipe, we will explain the underlying concepts that make Undo and Redo possible to implement in a generic way.</p>
<p>In the second part of this recipe, we will show how to use <a href="../../github.com/omnidan/redux-undo.html">Redux Undo</a> package that provides this functionality out of the box.</p>
<p><a href="../../twitter.com/dan_abramov/status/647038407286390784.html"><img src="../../i.imgur.com/lvDFHkH.gif" alt="demo of todos-with-undo" /></a></p>
<h2 id="understanding-undo-history"><span id="understanding-undo-history" class="anchor enhancedAnchor_2LWZ"></span>Understanding Undo History<a href="#understanding-undo-history" class="hash-link" title="Direct link to heading">#</a></h2>
<h3 id="designing-the-state-shape"><span id="designing-the-state-shape" class="anchor enhancedAnchor_2LWZ"></span>Designing the State Shape<a href="#designing-the-state-shape" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Undo history is also part of your app’s state, and there is no reason why we should approach it differently. Regardless of the type of the state changing over time, when you implement Undo and Redo, you want to keep track of the <em>history</em> of this state at different points in time.</p>
<p>For example, the state shape of a counter app might look like this:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> counter</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">10</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>If we wanted to implement Undo and Redo in such an app, we’d need to store more state so we can answer the following questions:</p>
<ul>
<li>Is there anything left to undo or redo?</li>
<li>What is the current state?</li>
<li>What are the past (and future) states in the undo stack?</li>
</ul>
<p>It is reasonable to suggest that our state shape should change to answer these questions:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> counter</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">2</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">3</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">4</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">5</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">6</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">7</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">8</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">9</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">10</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>Now, if user presses “Undo”, we want it to change to move into the past:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> counter</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">2</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">3</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">4</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">5</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">6</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">7</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">8</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">9</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">10</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>And further yet:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> counter</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">2</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">3</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">4</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">5</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">6</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">7</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">8</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">9</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">10</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>When the user presses “Redo”, we want to move one step back into the future:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> counter</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">2</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">3</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">4</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">5</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">6</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">7</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">8</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">9</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">10</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>Finally, if the user performs an action (e.g. decrement the counter) while we’re in the middle of the undo stack, we’re going to discard the existing future:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> counter</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">2</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">3</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">4</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">5</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">6</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">7</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">8</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">9</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">8</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>The interesting part here is that it does not matter whether we want to keep an undo stack of numbers, strings, arrays, or objects. The structure will always be the same:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> counter</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">2</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">3</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">4</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> todos</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Use Redux’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Use Redux’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> complete</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Use Redux’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> complete</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Implement Undo’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Use Redux’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> complete</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Implement Undo’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> complete</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>In general, it looks like this:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token constant" style="color: #f92672">T</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token constant" style="color: #f92672">T</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token constant" style="color: #f92672">T</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>It is also up to us whether to keep a single top-level history:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> counterA</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> counterB</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> counterA</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> counterB</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> counterA</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> counterB</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> counterA</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">2</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> counterB</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>Or many granular histories so user can undo and redo actions in them independently:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> counterA</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">2</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> counterB</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>We will see later how the approach we take lets us choose how granular Undo and Redo need to be.</p>
<h3 id="designing-the-algorithm"><span id="designing-the-algorithm" class="anchor enhancedAnchor_2LWZ"></span>Designing the Algorithm<a href="#designing-the-algorithm" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Regardless of the specific data type, the shape of the undo history state is the same:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token constant" style="color: #f92672">T</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token constant" style="color: #f92672">T</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token constant" style="color: #f92672">T</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>Let’s talk through the algorithm to manipulate the state shape described above. We can define two actions to operate on this state: <code class="language-js" >UNDO</code> and <code class="language-js" >REDO</code>. In our reducer, we will do the following steps to handle these actions:</p>
<h4 id="handling-undo"><span id="handling-undo" class="anchor enhancedAnchor_2LWZ"></span>Handling Undo<a href="#handling-undo" class="hash-link" title="Direct link to heading">#</a></h4>
<ul>
<li>Remove the <em>last</em> element from the <code class="language-js" >past</code>.</li>
<li>Set the <code class="language-js" >present</code> to the element we removed in the previous step.</li>
<li>Insert the old <code class="language-js" >present</code> state at the <em>beginning</em> of the <code class="language-js" >future</code>.</li>
</ul>
<h4 id="handling-redo"><span id="handling-redo" class="anchor enhancedAnchor_2LWZ"></span>Handling Redo<a href="#handling-redo" class="hash-link" title="Direct link to heading">#</a></h4>
<ul>
<li>Remove the <em>first</em> element from the <code class="language-js" >future</code>.</li>
<li>Set the <code class="language-js" >present</code> to the element we removed in the previous step.</li>
<li>Insert the old <code class="language-js" >present</code> state at the <em>end</em> of the <code class="language-js" >past</code>.</li>
</ul>
<h4 id="handling-other-actions"><span id="handling-other-actions" class="anchor enhancedAnchor_2LWZ"></span>Handling Other Actions<a href="#handling-other-actions" class="hash-link" title="Direct link to heading">#</a></h4>
<ul>
<li>Insert the <code class="language-js" >present</code> at the end of the <code class="language-js" >past</code>.</li>
<li>Set the <code class="language-js" >present</code> to the new state after handling the action.</li>
<li>Clear the <code class="language-js" >future</code>.</li>
</ul>
<h3 id="first-attempt-writing-a-reducer"><span id="first-attempt-writing-a-reducer" class="anchor enhancedAnchor_2LWZ"></span>First Attempt: Writing a Reducer<a href="#first-attempt-writing-a-reducer" class="hash-link" title="Direct link to heading">#</a></h3>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color: #f92672">null</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// (?) How do we initialize the present?</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">undoable</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color: #f8f8f2">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> past</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> present</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> future </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">switch</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">type</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘UNDO’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> previous </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> past</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">past</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">-</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> newPast </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> past</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">slice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> past</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">-</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> newPast</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> previous</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">present</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">future</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘REDO’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> next </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> future</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> newFuture </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> future</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">slice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">past</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> present</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> next</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> newFuture</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// (?) How do we handle other actions?</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> state</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>This implementation isn’t usable because it leaves out three important questions:</p>
<ul>
<li>Where do we get the initial <code class="language-js" >present</code> state from? We don’t seem to know it beforehand.</li>
<li>Where do we react to the external actions to save the <code class="language-js" >present</code> to the <code class="language-js" >past</code>?</li>
<li>How do we actually delegate the control over the <code class="language-js" >present</code> state to a custom reducer?</li>
</ul>
<p>It seems that reducer isn’t the right abstraction, but we’re very close.</p>
<h3 id="meet-reducer-enhancers"><span id="meet-reducer-enhancers" class="anchor enhancedAnchor_2LWZ"></span>Meet Reducer Enhancers<a href="#meet-reducer-enhancers" class="hash-link" title="Direct link to heading">#</a></h3>
<p>You might be familiar with <a href="../../en.wikipedia.org/wiki/Higher-order_function.html">higher order functions</a>. If you use React, you might be familiar with <a href="../../medium.com/%40dan_abramov/mixins-are-dead-long-live-higher-order-components-94a0d2f9e750.html">higher order components</a>. Here is a variation on the same pattern, applied to reducers.</p>
<p>A <em>reducer enhancer</em> (or a <em>higher order reducer</em>) is a function that takes a reducer, and returns a new reducer that is able to handle new actions, or to hold more state, delegating control to the inner reducer for the actions it doesn’t understand. This isn’t a new pattern—technically, <a href="../api/combinereducers.html"><code class="language-js" >combineReducers()</code></a> is also a reducer enhancer because it takes reducers and returns a new reducer.</p>
<p>A reducer enhancer that doesn’t do anything looks like this:</p>
<p><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">doNothingWith</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">reducer</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Just call the passed reducer</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">reducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>A reducer enhancer that combines other reducers might look like this:</p>
<p><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">combineReducers</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">reducers</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color: #f8f8f2">=</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color: #f8f8f2">{</span><span class="token parameter punctuation" style="color: #f8f8f2">}</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">keys</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">reducers</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">reduce</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">nextState</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> key</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Call every reducer with the part of the state it manages</span><span class="token plain"></span></p>
<p><span class="token plain"> nextState</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">key</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> reducers</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">key</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">key</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> nextState</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<h3 id="second-attempt-writing-a-reducer-enhancer"><span id="second-attempt-writing-a-reducer-enhancer" class="anchor enhancedAnchor_2LWZ"></span>Second Attempt: Writing a Reducer Enhancer<a href="#second-attempt-writing-a-reducer-enhancer" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Now that we have a better understanding of reducer enhancers, we can see that this is exactly what <code class="language-js" >undoable</code> should have been:</p>
<p><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">undoable</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">reducer</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Call the reducer with empty action to populate the initial state</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">reducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token keyword nil" style="color: #f92672">undefined</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Return a reducer that handles undo and redo</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color: #f8f8f2">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> past</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> present</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> future </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> state</span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">switch</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">action</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">type</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘UNDO’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> previous </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> past</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">past</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">-</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> newPast </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> past</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">slice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> past</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">-</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> newPast</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> previous</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain">present</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> </span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">future</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">case</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘REDO’</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> next </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> future</span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> newFuture </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> future</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">slice</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token number" style="color: #ae81ff">1</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">past</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> present</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> next</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> newFuture</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">// Delegate handling the action to the passed reducer</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> newPresent </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">reducer</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">present</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">present </span><span class="token operator" style="color: #f8f8f2">===</span><span class="token plain"> newPresent</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> state</span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token spread operator" style="color: #f8f8f2">…</span><span class="token plain">past</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> present</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> newPresent</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>We can now wrap any reducer into <code class="language-js" >undoable</code> reducer enhancer to teach it to react to <code class="language-js" >UNDO</code> and <code class="language-js" >REDO</code> actions.</p>
<p><span class="token comment" style="color: #c6cad2">// This is a reducer</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">function</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">todos</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color: #f8f8f2">=</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color: #f8f8f2">[</span><span class="token parameter punctuation" style="color: #f8f8f2">]</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">/* … */</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">// This is also a reducer!</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> undoableTodos </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">undoable</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">todos</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> createStore </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> store </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">createStore</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">undoableTodos</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘ADD_TODO’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Use Redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘ADD_TODO’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Implement Undo’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain">store</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> type</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘UNDO’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span></p>
<p>Copy</p>
<p>There is an important gotcha: you need to remember to append <code class="language-js" >.present</code> to the current state when you retrieve it. You may also check <code class="language-js" >.past.length</code> and <code class="language-js" >.future.length</code> to determine whether to enable or to disable the Undo and Redo buttons, respectively.</p>
<p>You might have heard that Redux was influenced by <a href="../../github.com/evancz/elm-architecture-tutorial/index.html">Elm Architecture</a>. It shouldn’t come as a surprise that this example is very similar to <a href="../../package.elm-lang.org/packages/TheSeamau5/elm-undo-redo/2.0.html">elm-undo-redo package</a>.</p>
<h2 id="using-redux-undo"><span id="using-redux-undo" class="anchor enhancedAnchor_2LWZ"></span>Using Redux Undo<a href="#using-redux-undo" class="hash-link" title="Direct link to heading">#</a></h2>
<p>This was all very informative, but can’t we just drop a library and use it instead of implementing <code class="language-js" >undoable</code> ourselves? Sure, we can! Meet <a href="../../github.com/omnidan/redux-undo.html">Redux Undo</a>, a library that provides simple Undo and Redo functionality for any part of your Redux tree.</p>
<p>In this part of the recipe, you will learn how to make a small “todo list” app logic undoable. You can find the full source of this recipe in the <a href="../../github.com/reduxjs/redux/tree/master/examples/todos-with-undo.html"><code class="language-js" >todos-with-undo</code> example that comes with Redux</a>.</p>
<h3 id="installation"><span id="installation" class="anchor enhancedAnchor_2LWZ"></span>Installation<a href="#installation" class="hash-link" title="Direct link to heading">#</a></h3>
<p>First of all, you need to run</p>
<p><span class="token plain">npm install redux-undo</span></p>
<p>Copy</p>
<p>This installs the package that provides the <code class="language-js" >undoable</code> reducer enhancer.</p>
<h3 id="wrapping-the-reducer"><span id="wrapping-the-reducer" class="anchor enhancedAnchor_2LWZ"></span>Wrapping the Reducer<a href="#wrapping-the-reducer" class="hash-link" title="Direct link to heading">#</a></h3>
<p>You will need to wrap the reducer you wish to enhance with <code class="language-js" >undoable</code> function. For example, if you exported a <code class="language-js" >todos</code> reducer from a dedicated file, you will want to change it to export the result of calling <code class="language-js" >undoable()</code> with the reducer you wrote:</p>
<h4 id="reducerstodos.js"><span id="reducerstodosjs" class="anchor enhancedAnchor_2LWZ"></span><code class="language-js" >reducers/todos.js</code><a href="#reducerstodosjs" class="hash-link" title="Direct link to heading">#</a></h4>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports">undoable</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux-undo’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">/* … */</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">todos</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color: #f8f8f2">=</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color: #f8f8f2">[</span><span class="token parameter punctuation" style="color: #f8f8f2">]</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token comment" style="color: #c6cad2">/* … */</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> undoableTodos </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">undoable</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">todos</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> undoableTodos</span></p>
<p>Copy</p>
<p>There are <a href="../../github.com/omnidan/redux-undo.html#configuration">many other options</a> to configure your undoable reducer, like setting the action type for Undo and Redo actions.</p>
<p>Note that your <code class="language-js" >combineReducers()</code> call will stay exactly as it was, but the <code class="language-js" >todos</code> reducer will now refer to the reducer enhanced with Redux Undo:</p>
<h4 id="reducersindex.js"><span id="reducersindexjs" class="anchor enhancedAnchor_2LWZ"></span><code class="language-js" >reducers/index.js</code><a href="#reducersindexjs" class="hash-link" title="Direct link to heading">#</a></h4>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> combineReducers </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports">todos</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./todos’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports">visibilityFilter</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./visibilityFilter’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> todoApp </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">combineReducers</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> todos</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> visibilityFilter</span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> todoApp</span></p>
<p>Copy</p>
<p>You may wrap one or more reducers in <code class="language-js" >undoable</code> at any level of the reducer composition hierarchy. We choose to wrap <code class="language-js" >todos</code> instead of the top-level combined reducer so that changes to <code class="language-js" >visibilityFilter</code> are not reflected in the undo history.</p>
<h3 id="updating-the-selectors"><span id="updating-the-selectors" class="anchor enhancedAnchor_2LWZ"></span>Updating the Selectors<a href="#updating-the-selectors" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Now the <code class="language-js" >todos</code> part of the state looks like this:</p>
<p><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> visibilityFilter</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘SHOW_ALL’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> todos</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> past</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Use Redux’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Use Redux’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> complete</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> present</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Use Redux’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> complete</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Implement Undo’</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> future</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">[</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Use Redux’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> complete</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"> text</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘Implement Undo’</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> complete</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token boolean" style="color: #ae81ff">true</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">]</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<p>This means you need to access your state with <code class="language-js" >state.todos.present</code> instead of just <code class="language-js" >state.todos</code>:</p>
<h4 id="containersvisibletodolist.js"><span id="containersvisibletodolistjs" class="anchor enhancedAnchor_2LWZ"></span><code class="language-js" >containers/VisibleTodoList.js</code><a href="#containersvisibletodolistjs" class="hash-link" title="Direct link to heading">#</a></h4>
<p><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">mapStateToProps</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> todos</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">getVisibleTodos</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">present</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">visibilityFilter</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span></p>
<p>Copy</p>
<h3 id="adding-the-buttons"><span id="adding-the-buttons" class="anchor enhancedAnchor_2LWZ"></span>Adding the Buttons<a href="#adding-the-buttons" class="hash-link" title="Direct link to heading">#</a></h3>
<p>Now all you need to do is add the buttons for the Undo and Redo actions.</p>
<p>First, create a new container component called <code class="language-js" >UndoRedo</code> for these buttons. We won’t bother to split the presentational part into a separate file because it is very small:</p>
<h4 id="containersundoredo.js"><span id="containersundoredojs" class="anchor enhancedAnchor_2LWZ"></span><code class="language-js" >containers/UndoRedo.js</code><a href="#containersundoredojs" class="hash-link" title="Direct link to heading">#</a></h4>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">/* … */</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">let</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">UndoRedo</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token parameter punctuation" style="color: #f8f8f2">{</span><span class="token parameter"> canUndo</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> canRedo</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> onUndo</span><span class="token parameter punctuation" style="color: #f8f8f2">,</span><span class="token parameter"> onRedo </span><span class="token parameter punctuation" style="color: #f8f8f2">}</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">p</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">button onClick</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">onUndo</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> disabled</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token operator" style="color: #f8f8f2">!</span><span class="token plain">canUndo</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token maybe-class-name">Undo</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">button</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">button onClick</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain">onRedo</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"> disabled</span><span class="token operator" style="color: #f8f8f2">=</span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token operator" style="color: #f8f8f2">!</span><span class="token plain">canRedo</span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token maybe-class-name">Redo</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">button</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">p</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span></p>
<p>Copy</p>
<p>You will use <code class="language-js" >connect()</code> from <a href="../../github.com/reduxjs/react-redux.html">React Redux</a> to generate a container component. To determine whether to enable Undo and Redo buttons, you can check <code class="language-js" >state.todos.past.length</code> and <code class="language-js" >state.todos.future.length</code>. You won’t need to write action creators for performing undo and redo because Redux Undo already provides them:</p>
<h4 id="containersundoredo.js-1"><span id="containersundoredojs-1" class="anchor enhancedAnchor_2LWZ"></span><code class="language-js" >containers/UndoRedo.js</code><a href="#containersundoredojs-1" class="hash-link" title="Direct link to heading">#</a></h4>
<p><span class="token comment" style="color: #c6cad2">/* … */</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">ActionCreators</span><span class="token imports"> </span><span class="token imports keyword module" style="color: #f92672">as</span><span class="token imports"> </span><span class="token imports maybe-class-name">UndoActionCreators</span><span class="token imports"> </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘redux-undo’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color: #f8f8f2">{</span><span class="token imports"> connect </span><span class="token imports punctuation" style="color: #f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react-redux’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token comment" style="color: #c6cad2">/* … */</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">mapStateToProps</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> canUndo</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">past</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> canRedo</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> state</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">future</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"> </span><span class="token number" style="color: #ae81ff">0</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">mapDispatchToProps</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token parameter">dispatch</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token keyword control-flow" style="color: #f92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">{</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">onUndo</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token maybe-class-name">UndoActionCreators</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">undo</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token function-variable function" style="color: #e6d874">onRedo</span><span class="token operator" style="color: #f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">dispatch</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token maybe-class-name">UndoActionCreators</span><span class="token punctuation" style="color: #f8f8f2">.</span><span class="token method function property-access" style="color: #e6d874">redo</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">}</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token maybe-class-name">UndoRedo</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token function" style="color: #e6d874">connect</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain">mapStateToProps</span><span class="token punctuation" style="color: #f8f8f2">,</span><span class="token plain"> mapDispatchToProps</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token maybe-class-name">UndoRedo</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> </span><span class="token maybe-class-name">UndoRedo</span></p>
<p>Copy</p>
<p>Now you can add <code class="language-js" >UndoRedo</code> component to the <code class="language-js" >App</code> component:</p>
<h4 id="componentsapp.js"><span id="componentsappjs" class="anchor enhancedAnchor_2LWZ"></span><code class="language-js" >components/App.js</code><a href="#componentsappjs" class="hash-link" title="Direct link to heading">#</a></h4>
<p><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘react’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Footer</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘./Footer’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">AddTodo</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../containers/AddTodo’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">VisibleTodoList</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../containers/VisibleTodoList’</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">UndoRedo</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">from</span><span class="token plain"> </span><span class="token string" style="color: #a6e22e">‘../containers/UndoRedo’</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword" style="color: #f92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color: #e6d874">App</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color: #f8f8f2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: #f8f8f2">(</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token plain">div</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">AddTodo</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">VisibleTodoList</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">Footer</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token maybe-class-name">UndoRedo</span><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">/</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"> </span><span class="token operator" style="color: #f8f8f2">&lt;</span><span class="token operator" style="color: #f8f8f2">/</span><span class="token plain">div</span><span class="token operator" style="color: #f8f8f2">&gt;</span><span class="token plain"></span></p>
<p><span class="token plain"></span><span class="token punctuation" style="color: #f8f8f2">)</span><span class="token plain"></span></p>
<p><span class="token plain" style="display: inline-block"> </span></p>
<p><span class="token plain"></span><span class="token keyword module" style="color: #f92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color: #f92672">default</span><span class="token plain"> </span><span class="token maybe-class-name">App</span></p>
<p>Copy</p>
<p>This is it! Run <code class="language-js" >npm install</code> and <code class="language-js" >npm start</code> in the <a href="../../github.com/reduxjs/redux/tree/master/examples/todos-with-undo.html">example folder</a> and try it out!</p>
<p><a href="computing-derived-data.html" class="pagination-nav__link"></a></p>

<p>« Computing Derived Data</p>
<p><a href="isolating-redux-sub-apps.html" class="pagination-nav__link"></a></p>

<p>Isolating Redux Sub-Apps »</p>
<ul>
<li><a href="#understanding-undo-history" class="table-of-contents__link">Understanding Undo History</a>
<ul>
<li><a href="#designing-the-state-shape" class="table-of-contents__link">Designing the State Shape</a></li>
<li><a href="#designing-the-algorithm" class="table-of-contents__link">Designing the Algorithm</a></li>
<li><a href="#first-attempt-writing-a-reducer" class="table-of-contents__link">First Attempt: Writing a Reducer</a></li>
<li><a href="#meet-reducer-enhancers" class="table-of-contents__link">Meet Reducer Enhancers</a></li>
<li><a href="#second-attempt-writing-a-reducer-enhancer" class="table-of-contents__link">Second Attempt: Writing a Reducer Enhancer</a></li>
</ul></li>
<li><a href="#using-redux-undo" class="table-of-contents__link">Using Redux Undo</a>
<ul>
<li><a href="#installation" class="table-of-contents__link">Installation</a></li>
<li><a href="#wrapping-the-reducer" class="table-of-contents__link">Wrapping the Reducer</a></li>
<li><a href="#updating-the-selectors" class="table-of-contents__link">Updating the Selectors</a></li>
<li><a href="#adding-the-buttons" class="table-of-contents__link">Adding the Buttons</a></li>
</ul></li>
</ul>


</ul>



</body>
</html>
